# auto_spy

## 介绍
简单介绍一下SPY的功能：
**监听**（跟傻妞的SPY一样）：自动监听设置好的频道或群，捕捉关键词，并转换成你脚本对应的环境变量，自动启动对应的任务

**队列**：当瞬间涌入多个同一脚本变量时，自动进入队列，当前面一个跑完，根据设置延时，自动跑下一个变量，有限抢占最新变量，并且不会遗漏线报做到捡漏；

**多频道**：每个频道线报优势均有所不同，SPY支持多频道监听，不同变量自动转换成脚本对应环境变量，实现多频道自动监听；

**去重**：多个频道线报有先后，内容有重复，SPY自动去重，防止跑无用线报内容，抢占第一手脚本运行；

**多任务**：每个脚本对应一个任务，均采用多线程管理，独立运行，互不干扰；

**不易黑IP**：因为是队列，每次跑的间隔自行设置，所以只要调整得当，不易黑IP，当然脚本造成的黑没有办法；



## 安装教程

1. 在linux里准备好python3.6和pip3环境，安装好screen以便后台运行；

2. 拉取代码：
   ```
   # 建文件夹
   mkdir autospy
   cd autospy
   # 拉取代码
   git clone  --depth=1  https://github.com/xieshang/AutoSpy.git .
   
   # 复制配置文件样例，如有自己的配置文件，文件放进来就可以了
   cp auto_spy_simple.yaml auto_spy.yaml
   ```

3. 启动一次脚本，生成最新配置：

   ```
   # 安装依赖
   pip3 install --user -U asyncio  pyyaml telethon snowland-smx httpx pysocks requests
   
   # 启动一次脚本
   python3 auto_spy_bot.py
   
   #然后ctrl + c 结束掉
   ```

4. 修改配置文件<auto_spy.yaml>，多看看auto_spy_simple.yaml里的样例说明，基本都在上面了（单变量、多变量、变量归一），这里重点说一下几个控制参数。

   ```
   * OverdueTime
   变量过期时间，即在第一次变量触发后，过多少秒后同一变量可以再次触发；
   若无此需求，设置为0，以防被恶意触发线报；
   * Wait
   当线报处于队列时，此参数用于动态控制延迟多久后再次执行下一个线报，用于降低黑IP，单位为秒，每个脚本之间的运行间隔：WaitTime+Wait；
   ```

5. 登录tg

   ```
   python3 auto_spy_bot.py
   手机号码：+86xxxxxxx.....   记得带头
   ```

## SPY指令

1、spy ?：查看spy支持的指令列表

2、**spy**：查看队列情况，10秒后自动撤回；
3、**spy 重启**：重启SPY；
4、**spy 升级**：升级到最新的SPY；

........


## 问题排查
* 登录TG的时候没跳出来要求输入电话？
```
请确认配置文件的API和hash是否填写正确；
```

* 发spy没反应？
```
1、确认masterid是不是你自己的？
2、spy有没有在运行呢？如果是screen后台
```

